<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
	<meta name="author" content="AdminKit">
	<meta name="keywords" content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="shortcut icon" href="assets/icon-48x48.png" />

	<title>GovData Monitor</title>

	<link href="assets/app.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.12/proj4.js" type="text/javascript"></script>
	<script src="https://cdn.jsdelivr.net/npm/ol@v7.3.0/dist/ol.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.3.0/ol.css">

	<script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
	<link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
</head>

<body>
	<div class="wrapper">
		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg d-block border-bottom border-1 border-secondary">
				<div class="navbar-collapse collapse">
					<ul class="navbar-nav">
						<li class="nav-item pt-1 pe-2 fs-4 border-end border-1 border-secondary border-opacity-50 d-none d-sm-block" style="margin-bottom:-2.25rem;line-height:4.5rem;">
							GovData Monitor
						</li>
						<li class="nav-item border-bottom border-4 border-info">
							<a class="nav-link" href="index.html">
								<i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Dashboard</span>
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="meter.html">
								<i class="align-middle" data-feather="activity"></i> <span class="align-middle">Meter</span>
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="catalogs.html">
								<i class="align-middle" data-feather="package"></i> <span class="align-middle">Catalogs</span>
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="datasets.html">
								<i class="align-middle" data-feather="inbox"></i> <span class="align-middle">Datasets</span>
							</a>
						</li>
					</ul>
				</div>
				<div class="navbar-collapse collapse">
					<ul class="navbar-nav">
						<li class="nav-item d-none d-sm-block" style="width:9.5rem;height:2.3rem;">
						</li>
					</ul>
				</div>
			</nav>

			<main class="content p-0">
				<div class="container-fluid p-0">

					<div class="row">
						<div class="col-xl-6 col-xxl-5 d-flex">
							<div class="w-100">

								<div class="card">
									<div class="card-body">
										<div class="row">
											<div class="col mt-0">
												<h5 class="card-title">To be done</h5>
											</div>
										</div>
										<h1 class="mt-1 mb-3">Infos</h1>
										<div class="mb-0">
											<span class="text-muted">later...</span>
										</div>
									</div>
								</div>

							</div>
						</div>
					</div>

					<div class="row">
						<div class="col">

							<div id='map' style='width: 400px; height: 300px;'></div>

						</div>
					</div>

				</div>
			</main>

			<footer class="footer">
				<div class="container-fluid">
					<div class="row text-muted">
						<div class="col-6 text-start">
							Made by Thomas Tursics
						</div>
						<div class="col-6 text-end">
							<ul class="list-inline">
								<li class="list-inline-item">
									<a class="text-muted" href="https://www.tursics.de/imprint" target="_blank">Imprint</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</footer>
		</div>
	</div>

	<script src="assets/app.js"></script>
	<script>
		var map = new maplibregl.Map({
			center: [10, 51],
			container: 'map',
//			customAttribution: 'test',
//			hash: true,
			style: 'https://sgx.geodatenzentrum.de/gdz_basemapde_vektor/styles/bm_web_col.json',
			zoom: 4
		});
		var source = 'https://sgx.geodatenzentrum.de/wfs_vg250?Service=WFS&Version=2.0.0&OUTPUTFORMAT=gml3&Request=GetFeature&TYPENAMES=vg250:vg250_lan&FILTER=%3CFilter%3E%3CPropertyIsEqualTo%3E%3CValueReference%3Ears%3C/ValueReference%3E%3CLiteral%3E11%3C/Literal%3E%3C/PropertyIsEqualTo%3E%3C/Filter%3E';

		map.on('load', function () {
			map.addSource('sample-gml', {
				'type': 'geojson',
				'data': source
			});
		});

		function loadGML(uri, callback) {
			var xhr = new XMLHttpRequest();
			xhr.open('GET', uri, true);

			xhr.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 200) {
					callback(this.responseText);
				} else if (this.readyState == 4) {
					callback(null);
				}
			}

			xhr.send();
		}

		// https://openlayers.org/en/latest/apidoc/module-ol_format_GML3-GML3.html
		var gml = new ol.format.GML3();
		loadGML(source, function(xml) {
			var pos = xml.indexOf('<gml:Envelope srsName=');
			pos = xml.indexOf('"', pos) + 1;
			var srsName = xml.substring(pos, xml.indexOf('"', pos));
			console.log(srsName);
			console.log('');
			console.log(ol.proj.get(srsName));
			console.log(ol.proj.get('EPSG:25832'));

			var projectionName = 'EPSG:25832';
	        proj4.defs(projectionName, '+proj=utm +zone=32 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs');

			console.log(ol.proj.get('EPSG:25832'));

			ol.proj.addEquivalentProjections(
				ol.proj.get('EPSG:25832'),
				ol.proj.get('urn:x-ogc:def:crs:EPSG:25832'));
			console.log('');

			var features = gml.readFeatures(xml);
			console.log(features);
		});

		// center: ol.proj.transform([8.22, 53.15], 'EPSG:4326', projectionName),

		// Translate gml geometries to geojson
		//   https://www.npmjs.com/package/@permettezmoideconstruire/gml-to-geojson

		// Transform point coordinates from one coordinate system to another, including datum transformations:
		//   https://www.npmjs.com/package/proj4

		// Collection of open source loaders and writers for file formats including tabular, geospatial, and 3D formats. It is focused on supporting visualization and analytics of big data.
		//   https://loaders.gl/docs
		//   https://loaders.gl/docs/modules/wms/api-reference/gml-loader#usage

		// OpenLayers makes it easy to put a dynamic map in any web page
		//   https://openlayers.org/
	</script>
</body>

</html>